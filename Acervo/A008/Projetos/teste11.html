<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Exposição MATEMATIVA</title>
<style>
  :root{
    --azul-principal: #001a80;
    --azul-claro: #0022aa;
    --tab-padding: 10px;
  }

  /* Reset mínimo */
  * { box-sizing: border-box; }

  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f0f2f8;
    -webkit-font-smoothing:antialiased;
  }

  /* Header / topo */
  header {
    background: var(--azul-principal);
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  }
  header img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
    background: var(--azul-principal);
  }

  /* busca */
  #search-container {
    background: var(--azul-principal);
    padding: 8px;
    display:flex;
    gap:8px;
    align-items:center;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  #typeSelect {
    padding:8px;
    font-size:12px;
    border-radius:6px;
    border:1px solid #ccc;
    background:white;
  }
  #search {
    flex:1;
    padding:8px;
    font-size:13px;
    border-radius:6px;
    border:1px solid #ccc;
  }

  /* Tabs */
  .tab-container { display:flex; align-items:stretch; width:100%; }
  .tab-image-box {
    width: 60px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:#f0f0f0;
    border-right:1px solid #ccc;
    padding:6px;
    flex-shrink:0;
  }
  .tab-image-box img {
    width:100%;
    object-fit:contain;
    border-radius:8px;
    margin-bottom:4px;
  }
  .tab-image-box .tab-name { font-size:10px; color:#333; text-align:center; }

  .tabs-flex { display:flex; flex:1; }
  .tab {
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: var(--tab-padding) 10px;
    cursor:pointer;
    font-weight:bold;
    font-size:13px;
    background:#e0e0e0;
    margin:2px;
    border-radius:6px 6px 0 0;
    transition: all .18s ease;
  }
  .tab.active {
    background: var(--azul-principal);
    color: white;
    transform: translateY(-2px);
  }

  /* Content */
  #content {
    padding:12px;
    min-height: 380px;
    background: linear-gradient(to bottom, var(--azul-principal) 60%, var(--azul-claro));
    color: #fff;
    transition: opacity .18s ease;
  }
  #content h2 { margin-top:0; font-size:20px; text-shadow:0 1px 3px rgba(0,0,0,0.25); }

  /* Chips */
  .chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
  .chip {
    background: var(--azul-principal);
    color: #fff;
    padding:6px 10px;
    border-radius:20px;
    font-size:13px;
    border:1px solid rgba(255,255,255,0.12);
    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
  }

  /* Thumbnail grid */
  .thumbnail-grid {
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap:14px;
    margin-top:8px;
    align-items:start;
  }
  .thumbnail-card {
    width:100%;
    max-width: 220px;
    background: rgba(255,255,255,0.95);
    border-radius:10px;
    padding:10px;
    text-align:center;
    cursor:pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    transition: transform .12s ease, box-shadow .12s ease;
    margin: 0 auto;
  }
  .thumbnail-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.18); }
  .thumbnail-card img { width:100%; height:120px; object-fit:contain; border-radius:8px; display:block; margin-bottom:8px; }
  .thumbnail-card h3 { margin:6px 0 4px 0; font-size:13px; color:var(--azul-principal); }
  .thumbnail-card p { margin:0; font-size:12px; color:#333; }

  /* ALBUM (sem barra visível) */
  .album-container {
    position:relative;
    margin-bottom:12px;
  }
  .album-wrapper {
    display:flex;
    gap:8px;
    overflow:hidden; /* escondemos a barra */
    width:100%;
    align-items:center;
  }
  .album-wrapper .album-item {
    flex: 0 0 auto;
    width:240px;
    height:160px;
    border-radius:8px;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    background: #fff;
  }
  .album-wrapper img { width:100%; height:100%; object-fit:contain; display:block; }

  /* Ver tudo card (mesmo tamanho que foto) */
  .ver-tudo {
    width:240px;
    height:160px;
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    background: white;
    border: 2px solid var(--azul-principal);
    transition: all .22s ease;
  }
  .ver-tudo a { color: var(--azul-principal); font-weight:bold; text-decoration:none; font-size:16px; }
  .ver-tudo:hover { background: var(--azul-principal); }
  .ver-tudo:hover a { color: white; }

  /* Setas flutuantes */
  .album-arrow {
    position:absolute;
    top:50%;
    transform: translateY(-50%);
    width:44px;
    height:44px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    background: rgba(0,0,0,0.28);
    color: white;
    border:none;
    cursor:pointer;
    z-index: 10;
    transition: background .12s ease, transform .12s ease;
  }
  .album-arrow:hover { background: rgba(0,0,0,0.55); transform: scale(1.05); }
  .album-arrow.left { left: 8px; }
  .album-arrow.right { right: 8px; }

  /* ocultar as barras nativas */
  .album-wrapper::-webkit-scrollbar { display:none; }
  .album-wrapper { -ms-overflow-style: none; scrollbar-width: none; }

  /* responsividade */
  @media (max-width:900px){
    .album-wrapper .album-item, .ver-tudo { width:200px; height:140px; }
  }
  @media (max-width:600px){
    header{ height:120px; }
    #search{ font-size:14px; }
    #typeSelect{ font-size:14px; }
    .album-wrapper .album-item, .ver-tudo { width:160px; height:110px; }
    .album-arrow { display:none; } /* setas escondidas em telas muito pequenas por espaço */
  }
</style>
</head>
<body>

<header>
  <!-- substitua a imagem pela sua no caminho correto -->
  <img src="../../../Figuras/A008_topo.png" alt="MATEMATIVA">
</header>

<div id="search-container">
  <select id="typeSelect">
    <option value="peca">Peça</option>
    <option value="evento">Evento</option>
    <option value="material">Material</option>
  </select>
  <input id="search" type="text" placeholder="Buscar peça, evento ou material..." />
</div>

<div id="tabs"></div>
<div id="content" role="main"></div>

<script>
/* -------------------------
   Dados de exemplo (local)
   - Agora cada item tem campo `album` separado (link p/ Google Fotos)
   - imagens[] contém apenas imagens (sem misturar link do álbum)
   ------------------------- */
const pecas = [
  {
    id: 1,
    nome: "Mecanismo de Watt",
    descricao: "Peça que demonstra movimento plano a partir de ligações articuladas.",
    numero: "002",
    setor: "Geometria das Curvas",
    percurso: "Construção de Retas",
    eventos: [1,2],
    materiais: [1,2],
    imagens: ["../../../Figuras/P002.png", "../../../Figuras/P003.png", "../../../Figuras/P004.png", "../../../Figuras/P005.png", "../../../Figuras/P006.png"],
    album: "https://photos.app.goo.gl/aXiPS8jCq23nuKPC8"
  },
  {
    id: 2,
    nome: "Mecanismo de Tchebycheff",
    descricao: "Dispositivo para gerar movimento retilíneo perfeito.",
    numero: "003",
    setor: "Geometria das Curvas",
    percurso: "Construção de Retas",
    eventos: [1,3],
    materiais: [2],
    imagens: ["../../../Figuras/P003.png", "../../../Figuras/P007.png", "../../../Figuras/P008.png"],
    album: "" // sem álbum - botão "Ver tudo" não aparece
  },
  {
    id: 3,
    nome: "Poliedro de Arquimedes",
    descricao: "Modelo tridimensional que ilustra sólidos semirregulares.",
    numero: "004",
    setor: "Geometria Espacial",
    percurso: "Poliedros",
    eventos: [2,3],
    materiais: [3],
    imagens: ["../../../Figuras/P004.png", "../../../Figuras/P009.png"],
    album: "https://photos.app.goo.gl/exemploPoliedro"
  }
];

const eventos = [
  {
    id: 1,
    nome: "Semana da Matemática 2001",
    descricao: "Evento acadêmico no Departamento de Matemática.",
    numero: "000",
    local: "Departamento de Matemática",
    cidade: "Maringá - PR",
    pecas: [1,2],
    docs: [3],
    imagens: ["../../../Figuras/E000.jpg", "../../../Figuras/E000_2.png"],
    album: "https://photos.app.goo.gl/exemploEvento1"
  },
  {
    id: 2,
    nome: "Usina de Conhecimento 2005",
    descricao: "Exposição de ciência e tecnologia em Maringá.",
    numero: "010",
    local: "Parque de Exposições",
    cidade: "Maringá - PR",
    pecas: [1,3],
    docs: [2],
    imagens: ["../../../Figuras/E002.jpg"],
    album: ""
  }
];

const materiais = [
  { id: 1, nome: "Ficha Técnica 2025", numero:"009", link: "#", imagens: ["../../../Figuras/P002_ig.png"], album: "" },
  { id: 2, nome: "Display 2025", numero:"007", link: "#", imagens: ["../../../Figuras/A007.png"], album: "" },
  { id: 3, nome: "Cartaz Semana 2001", numero:"000", link: "#", imagens: ["../../../Figuras/E000_2.png"], album: "https://photos.app.goo.gl/8aXie1AkKg7RmxsY6" }
];

/* estado atual */
let currentType = "peca";
let currentId = 1;
let currentTab = "overview";

/* ---------- RENDER TABS ---------- */
function renderTabs(){
  const tabs = document.getElementById("tabs");
  const item = getItem(currentType, currentId);
  const titleHTML = `
    <div class="tab-image-box">
      ${item && item.imagens && item.imagens[0] ? `<img src="${item.imagens[0]}" alt="${item.nome}">` : ""}
      <div class="tab-name">${item && item.numero ? item.numero : ""}</div>
    </div>
  `;

  let tabsHTML = "";
  if(currentType === "peca"){
    tabsHTML = `
      <div class="tab ${currentTab==='overview'?'active':''}" data-tab="overview">Visão Geral</div>
      <div class="tab ${currentTab==='events'?'active':''}" data-tab="events">Eventos</div>
      <div class="tab ${currentTab==='materiais'?'active':''}" data-tab="materiais">Materiais</div>
    `;
  } else if(currentType === "evento"){
    tabsHTML = `
      <div class="tab ${currentTab==='overview'?'active':''}" data-tab="overview">Visão Geral</div>
      <div class="tab ${currentTab==='pecas'?'active':''}" data-tab="pecas">Peças</div>
      <div class="tab ${currentTab==='docs'?'active':''}" data-tab="docs">Materiais</div>
    `;
  } else { // material
    tabsHTML = `
      <div class="tab ${currentTab==='overview'?'active':''}" data-tab="overview">Visão Geral</div>
      <div class="tab ${currentTab==='pecas'?'active':''}" data-tab="pecas">Peças</div>
      <div class="tab ${currentTab==='eventos'?'active':''}" data-tab="eventos">Eventos</div>
    `;
  }

  tabs.innerHTML = `<div class="tab-container">${titleHTML}<div class="tabs-flex">${tabsHTML}</div></div>`;

  // listeners
  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=>{
      currentTab = t.dataset.tab;
      renderTabs();
      renderContent();
    });
  });
}

/* ---------- GET ITEM ---------- */
function getItem(type,id){
  if(type==="peca") return pecas.find(p=>p.id===id) || pecas[0];
  if(type==="evento") return eventos.find(e=>e.id===id) || eventos[0];
  if(type==="material") return materiais.find(m=>m.id===id) || materiais[0];
  return null;
}

/* ---------- RENDER CONTENT ---------- */
function renderContent(){
  const content = document.getElementById("content");
  content.style.opacity = 0;
  // delay breve para efeito de fade
  setTimeout(()=>{
    const item = getItem(currentType, currentId);
    let html = `<h2>${item.nome}</h2>`;

    if(currentTab === "overview"){
      // álbum (apresenta imagens e opcional "Ver tudo")
      if(item.imagens && item.imagens.length > 0){
        const imagesOnly = item.imagens.slice(); // array de imagens (somente imgs)
        // limite de exibição inicial (você pode ajustar); nós permitimos todos, as setas controlarão o overflow
        const albumHtml = [];
        imagesOnly.forEach(src=>{
          albumHtml.push(`<div class="album-item album-item-img"><img src="${src}" alt="${item.nome}"></div>`);
        });

        // ver tudo (aparece somente se item.album for truthy e não vazio)
        const hasAlbumLink = item.album && item.album.trim().length > 6;

        const verTudoHtml = hasAlbumLink ? `<div class="album-item ver-tudo"><a href="${item.album}" target="_blank" rel="noopener noreferrer">Ver tudo →</a></div>` : '';

        html += `
          <div class="album-container">
            <button class="album-arrow left" aria-label="Anterior" onclick="scrollAlbum(-1)" style="display:none;">❮</button>
            <div class="album-wrapper" id="album">${albumHtml.join('')}${verTudoHtml}</div>
            <button class="album-arrow right" aria-label="Próximo" onclick="scrollAlbum(1)" style="display:none;">❯</button>
          </div>
        `;
      }

      // descrição e chips
      html += `<p style="margin-top:6px;">${item.descricao || ''}</p>`;
      html += `<div class="chips">`;
      if(item.numero) html += `<div class="chip">Número: ${item.numero}</div>`;
      if(item.setor) html += `<div class="chip">Setor: ${item.setor}</div>`;
      if(item.percurso) html += `<div class="chip">Percurso: ${item.percurso}</div>`;
      if(item.local) html += `<div class="chip">Local: ${item.local}</div>`;
      if(item.cidade) html += `<div class="chip">Cidade: ${item.cidade}</div>`;
      html += `</div>`;
      if(item.link) html += `<p style="margin-top:10px;"><a href="${item.link}" target="_blank" rel="noopener noreferrer" style="color:#fff;text-decoration:underline;">Abrir material</a></p>`;
    } else {
      // outras abas -> lista de relações como thumbnails
      html += renderRelations(item);
    }

    content.innerHTML = html;
    content.style.opacity = 1;

    // após inserir conteúdo, ativar comportamento do álbum (mostrar setas se necessário)
    setupAlbumControls();
  }, 90);
}

/* ---------- album scroll control ---------- */
function setupAlbumControls(){
  const album = document.getElementById("album");
  if(!album) return;
  const left = album.parentElement.querySelector('.album-arrow.left');
  const right = album.parentElement.querySelector('.album-arrow.right');

  // recalcula mostrar/ocultar setas conforme overflow
  function updateArrows(){
    // se a wrapper tem scrollWidth > clientWidth => overflow
    const need = album.scrollWidth > album.clientWidth + 2; // margem pequena
    if(need){
      left.style.display = '';
      right.style.display = '';
    } else {
      left.style.display = 'none';
      right.style.display = 'none';
    }
    // também atualizar estado de disabled (quando chegar ao fim)
    left.disabled = (album.scrollLeft <= 2);
    right.disabled = (album.scrollLeft + album.clientWidth >= album.scrollWidth - 2);
    left.style.opacity = left.disabled ? '0.5' : '1';
    right.style.opacity = right.disabled ? '0.5' : '1';
  }

  // primeira atualização
  updateArrows();

  // observar mudanças de tamanho/resizing
  window.addEventListener('resize', updateArrows);
  album.addEventListener('scroll', updateArrows);

  // small helper: keyboard support (left/right while album focused)
  album.tabIndex = 0;
  album.addEventListener('keydown', e=>{
    if(e.key === 'ArrowLeft') { album.scrollBy({ left: -260, behavior:'smooth' }); e.preventDefault(); }
    if(e.key === 'ArrowRight') { album.scrollBy({ left: 260, behavior:'smooth' }); e.preventDefault(); }
  });
}

/* ação quando clica setas */
function scrollAlbum(direction){
  const album = document.getElementById("album");
  if(!album) return;
  const step = album.clientWidth >= 240 ? album.clientWidth - 40 : 260; // deslocamento
  album.scrollBy({ left: direction * step, behavior:'smooth' });
}

/* ---------- render relations (peças <-> eventos <-> materiais) ---------- */
function renderRelations(item){
  let list = [];
  let linkType = currentType;

  if(currentType === "peca"){
    if(currentTab === "events") { list = (item.eventos||[]).map(id=>eventos.find(e=>e.id===id)).filter(Boolean); linkType = 'evento'; }
    if(currentTab === "materiais") { list = (item.materiais||[]).map(id=>materiais.find(m=>m.id===id)).filter(Boolean); linkType = 'material'; }
  } else if(currentType === "evento"){
    if(currentTab === "pecas") { list = (item.pecas||[]).map(id=>pecas.find(p=>p.id===id)).filter(Boolean); linkType = 'peca'; }
    if(currentTab === "docs") { list = (item.docs||[]).map(id=>materiais.find(m=>m.id===id)).filter(Boolean); linkType = 'material'; }
  } else { // material
    if(currentTab === "pecas") { list = pecas.filter(p=> (p.materiais||[]).includes(item.id)); linkType = 'peca'; }
    if(currentTab === "eventos") {
      const pecasRelacionadas = pecas.filter(p=> (p.materiais||[]).includes(item.id));
      const eventosUnicos = [...new Set(pecasRelacionadas.flatMap(p => p.eventos || []))];
      list = eventosUnicos.map(id => eventos.find(e=>e.id===id)).filter(Boolean);
      linkType = 'evento';
    }
  }

  if(!list || list.length === 0) return "<p>Nenhum item relacionado.</p>";

  let html = `<div class="thumbnail-grid">`;
  list.forEach(it=>{
    html += `
      <div class="thumbnail-card" onclick="openItem('${linkType}', ${it.id})" role="button" tabindex="0">
        ${it.imagens && it.imagens[0] ? `<img src="${it.imagens[0]}" alt="${it.nome}">` : ''}
        <h3>${it.nome}</h3>
        <p>${it.descricao || it.cidade || (it.link? `<a href="${it.link}" target="_blank" rel="noopener noreferrer">Abrir</a>` : '')}</p>
      </div>
    `;
  });
  html += `</div>`;
  return html;
}

/* ---------- openItem ---------- */
function openItem(type, id){
  currentType = type;
  currentId = id;
  currentTab = "overview";
  renderTabs();
  renderContent();
}

/* ---------- Busca ---------- */
document.getElementById("search").addEventListener('keydown', (e)=>{
  if(e.key !== 'Enter') return;
  const q = e.target.value.toLowerCase().trim();
  const type = document.getElementById("typeSelect").value;
  if(q === ""){
    showAll(type);
    return;
  }
  let arr = type === 'peca' ? pecas : type === 'evento' ? eventos : materiais;
  const results = arr.filter(i => (i.nome || '').toLowerCase().includes(q));
  if(results.length === 1) openItem(type, results[0].id);
  else if(results.length > 1) showAll(type, results);
  else alert(`${type.charAt(0).toUpperCase() + type.slice(1)} não encontrado.`);
});

/* ---------- showAll (lista múltiplos resultados) ---------- */
function showAll(type, list=null){
  const arr = list || (type==='peca' ? pecas : type==='evento' ? eventos : materiais);
  let html = `<h2>Todos os ${type==='peca' ? 'Itens do Acervo' : type==='evento' ? 'Eventos' : 'Materiais'}</h2>`;
  html += `<div class="thumbnail-grid">`;
  arr.forEach(i=>{
    html += `
      <div class="thumbnail-card" onclick="openItem('${type}', ${i.id})" role="button" tabindex="0">
        ${i.imagens && i.imagens[0] ? `<img src="${i.imagens[0]}" alt="${i.nome}">` : ''}
        <h3>${i.nome}</h3>
        <p>${i.descricao || i.cidade || (i.link ? `<a href="${i.link}" target="_blank" rel="noopener noreferrer">Abrir</a>` : '')}</p>
      </div>
    `;
  });
  html += `</div>`;
  document.getElementById("tabs").innerHTML = ''; // limpa as tabs
  const content = document.getElementById("content");
  content.style.opacity = 0;
  setTimeout(()=>{ content.innerHTML = html; content.style.opacity = 1; }, 90);
}

/* ---------- Inicialização ---------- */
renderTabs();
renderContent();

/* ---------- Observers: recalcula setas se redimensionar ou trocar orientações ---------- */
window.addEventListener('resize', () => {
  // apenas re-trigger setup se álbum estiver presente
  setTimeout(()=>{ setupAlbumControls(); }, 150);
});
</script>

</body>
</html>
